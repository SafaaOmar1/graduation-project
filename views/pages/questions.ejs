<!DOCTYPE html>
<html>

<head>
    <% include ../partials/header.ejs %>



    
</head>

<body>

    <% include ../partials/nav.ejs %>

        <div class="container">

            <hr>
            <div class="row">
                <div class="col-md-12">
                    <questions>

                    </questions>
                </div>
            </div>
            <!-- row -->
        </div>
        <script>
            function shuffle(ch) {
                // var currentIndex = ch.length, temporaryValue, randomIndex;
                
                // // While there remain elements to shuffle...
                // while (0 !== currentIndex) {
                    
                //     // Pick a remaining element...
                //     randomIndex = Math.floor(Math.random() * currentIndex);
                //     currentIndex -= 1;
                    
                //     // And swap it with the current element.
                //     temporaryValue = ch[currentIndex];
                //     ch[currentIndex] = ch[randomIndex];
                //     ch[randomIndex] = temporaryValue;
                // }
                
                // return ch;
                for (var i = ch.length - 1; i > 0; i--) {
        var j = Math.floor(Math.random() * (i + 1));
        var temp = ch[i];
        ch[i] = ch[j];
        ch[j] = temp;
    }
return ch;
            }
            
            let mayBeTopic = location.href.split("questions/")[1];
            let topic = mayBeTopic ? mayBeTopic.split("?")[0] : "";
            let url = "/api/topics" + (topic ? `/${topic}` : "") + "/questions";

            var allQuestionsElement = $("questions");
            $.ajax({
                url: url,
                dataType: "json",
                accepts: "application/json"
            }).then(response => {
                let questions = JSON.parse(response);
                var ch = questions[0].choices;
                console.log(ch);
                // var tmp = ch[0];
                // ch[0] = ch[1];
                // ch[1] = tmp;
                // var ch = [1,2,3,4];
                // ch = shuffle(ch);
                // for (var i = ch.length - 1; i > 0; i--) {
                //     var j = Math.floor(Math.random() * (i + 1));
                //     console.log(ch[i]);
                //     console.log(ch[j]);
                //     var temp = ch[i];
                //     ch[i] = ch[j];
                //     ch[j] = temp;
                // }
            ////    var msh = require('shuffle-array');
   // var collection = [1,2,3,4,5];
 
//msh(collection);
 
// console.log(collection);
                console.log(ch);
                questions.forEach((question, i) => {
                    var questionElement = $("<ul/>");
                    $("<h3>").text(question.questionBody).appendTo(questionElement);
                        var ch = question.choices;
                        for (var i = ch.length - 1; i > 0; i--) {
                            var j = Math.floor(Math.random() * (i + 1));
                            console.log(ch[i]);
                            console.log(ch[j]);
                            var temp = ch[i];
                            ch[i] = ch[j];
                            ch[j] = temp;
                            
                        }
                        question.choices.forEach(choice => {
                    
                      //  ul.appendChild(ul.children[Math.random() * i | 0])
                    let choiceElement = $(`<li><input type='radio' name="questions[${i}]"/> <label>${choice.text}</label></li>`);
                         choiceElement.appendTo(questionElement);

                        
                    });
                    questionElement.appendTo(allQuestionsElement);
                });
            });





            }
             

            function Quiz() {
                
                $.ajax({
                    url: url,
                    dataType: "json",
                    accepts: "application/json"
                }).then(response => {
                    let questions = JSON.parse(response);
                  

allQuestionsElement.html("")
                   
                    let QuizQuestions =   _.shuffle(questions)
                    allQuestionsElement.data("questions",questions);

                    
                   
                QuizQuestions.forEach((question, k) => {
                        var questionElement = $(`<ul data-question-index="${k}"/>`).data("question",question);
                        $("<h3>").text(question.questionBody).appendTo(questionElement);
                        //  $("<h5  style ='visibility: hidden;'>").text(question.strategy).appendTo(questionElement);

                      
                     

                        _.shuffle(question.choices).slice(0,4).forEach((choice,ci) => {
                            //  ul.appendChild(ul.children[Math.random() * i | 0])
                            let choiceElement = $(`<li><input type='radio'  data-choice-index="${ci}" name="questions[${k}] " /> <label>${choice.text}</label></li>`);
                            choiceElement.appendTo(questionElement);
                        });
                        questionElement.appendTo(allQuestionsElement);
                       submit.appendTo(allQuestionsElement)
                    });


                });

            }




           function submitAnswer(){


               allQuestionsElement.forEach((question,i)=>{


             var selectedAnswer = $( `ul[data-question-index="${i}"]`).find("input:checked")

let temp1 =selectedAnswer.data("choiceIndex")

selectedAnswer.data("choiceIndex") == temp1.id

if( selectedAnswer.data("choiceIndex") != temp1.id){
 selectedAnswer.closest("ul").append(`<p class='alert alert-warning'> False!! correct answer is ${temp1.text} </p>`)
}

               });






           }


          

        </script>
</body>

</html>